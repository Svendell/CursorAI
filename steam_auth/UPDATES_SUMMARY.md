# üéØ –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ steamguard

## üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

–ü—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π Steam –±–∏–±–ª–∏–æ—Ç–µ–∫ (Steam Desktop Authenticator –∏ Steampy). –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

---

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. **app/steam_guard.py** - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏

**–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

#### ‚úÖ SteamGuardManager.create_mafile_from_dict()
- ‚úîÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è otpauth URI –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úîÔ∏è –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –≤–µ–±-—Å–µ—Å—Å–∏–∏ (web_cookie, token_gid)
- ‚úîÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è base64 —Ñ–æ—Ä–º–∞—Ç–∞
- ‚úîÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

#### ‚úÖ SteamGuardManager.get_steam_guard_code()
- ‚úîÔ∏è **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –ê–ª–≥–æ—Ä–∏—Ç–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Å base-10 –Ω–∞ base-23
  - –ë—ã–ª–æ: `code = str(four_bytes % 100000).zfill(5)` ‚Üí "00000", "12345"
  - –°—Ç–∞–ª–æ: base-23 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí "2CVJD", "7RKTY"
- ‚úîÔ∏è **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ª—Ñ–∞–≤–∏—Ç "23456789BCDFGHJKMNPQRTVWXY" (–±–µ–∑ I, O, L, S, Z)
- ‚úîÔ∏è **–î–û–ë–ê–í–õ–ï–ù–û:** –í–æ–∑–≤—Ä–∞—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Å–º–µ–Ω—ã –∫–æ–¥–∞
- ‚úîÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ time_offset –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### ‚úÖ SteamGuardManager.get_confirmation_key() - –ù–û–í–´–ô –ú–ï–¢–û–î
- ‚úîÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
- ‚úîÔ∏è **–ò–°–ü–†–ê–í–õ–ï–ù–û:** Timestamp –∫–∞–∫ struct.pack('>Q'), –Ω–µ —Å—Ç—Ä–æ–∫–∞
- ‚úîÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∞–≥–æ–≤ (conf, allow, deny, details)
- ‚úîÔ∏è RFC 4226 Dynamic Truncation

#### ‚úÖ SteamGuardManager.get_confirmation_operations() - –ù–û–í–´–ô –ú–ï–¢–û–î
- ‚úîÔ∏è –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚úîÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ–π–¥–æ–≤ –∏ –º–∞—Ä–∫–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

#### ‚úÖ SteamGuardManager.confirm_operation() - –ù–û–í–´–ô –ú–ï–¢–û–î
- ‚úîÔ∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úîÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π

#### ‚úÖ MafileCreator - –í—Å–µ –º–µ—Ç–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úîÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π mafile
- ‚úîÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üìä –¢–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –§—É–Ω–∫—Ü–∏—è | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –°—Ç–∞—Ç—É—Å |
|---------|------|-------|--------|
| get_steam_guard_code | base-10 (5 —Ü–∏—Ñ—Ä) | base-23 (5 —Å–∏–º–≤–æ–ª–æ–≤) | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –ê–ª—Ñ–∞–≤–∏—Ç | 0-9 | 23456789BCDFGHJKMNPQRTVWXY | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| URI –ø–æ–ª–µ –≤ mafile | "" (–ø—É—Å—Ç–æ) | otpauth://... | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ |
| Confirmation Key | str(timestamp) | struct.pack(>Q, ts) | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| web_cookie –ø–æ–ª–µ | –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –¥–æ–±–∞–≤–ª–µ–Ω–æ | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ |
| get_confirmation_key() | –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç | –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ | ‚úÖ –ù–æ–≤—ã–π |
| confirm_operation() | –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç | –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ | ‚úÖ –ù–æ–≤—ã–π |

---

## üîç –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä 1: Steam Guard –∫–æ–¥

**–ë—ã–ª–æ:**
```python
code = str(four_bytes % 100000).zfill(5)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: "00123", "45678", "99999"
```

**–°—Ç–∞–ª–æ:**
```python
ALPHABET = "23456789BCDFGHJKMNPQRTVWXY"
code = ""
for i in range(5):
    code = ALPHABET[four_bytes % len(ALPHABET)] + code
    four_bytes //= len(ALPHABET)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: "2CVJD", "7RKTY", "23456"
```

**–ü–æ—á–µ–º—É:**
- Steam –∏—Å–ø–æ–ª—å–∑—É–µ—Ç base-23, –∞ –Ω–µ base-10
- –ò—Å–∫–ª—é—á–µ–Ω—ã –∫–æ–Ω—Ñ—É–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (0, 1, I, O, L, S, Z)
- –ë–æ–ª–µ–µ —É–¥–æ–±–Ω–æ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞

### –ü—Ä–∏–º–µ—Ä 2: Confirmation Key

**–ë—ã–ª–æ:**
```python
message = str(timestamp).encode('utf-8') + tag.encode('utf-8')
# timestamp –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ - –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
```

**–°—Ç–∞–ª–æ:**
```python
buffer = struct.pack('>Q', timestamp) + tag.encode('utf-8')
# timestamp –∫–∞–∫ 8 –±–∞–π—Ç big-endian - –ü–†–ê–í–ò–õ–¨–ù–û
```

**–ü–æ—á–µ–º—É:**
- –†–µ–∞–ª—å–Ω—ã–π Steam API —Ç—Ä–µ–±—É–µ—Ç binary —Ñ–æ—Ä–º–∞—Ç
- –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å Steam Desktop Authenticator —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –°—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∞—Å—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á

### –ü—Ä–∏–º–µ—Ä 3: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ mafile

**–ë—ã–ª–æ:**
```python
{
    "shared_secret": "...",
    "account_name": "user",
    "identity_secret": "",
    "revocation_code": "",
    "uri": "",  # –ø—É—Å—Ç–æ!
    "fully_enrolled": True
}
```

**–°—Ç–∞–ª–æ:**
```python
{
    "shared_secret": "...",
    "account_name": "user",
    "identity_secret": "...",
    "revocation_code": "...",
    "uri": "otpauth://totp/Steam:user?secret=...&issuer=Steam",  # QR –∫–æ–¥!
    "session_id": "...",
    "token_gid": "...",
    "web_cookie": "...",  # –Ω–æ–≤–æ–µ!
    "server_time": 1234567890,
    "fully_enrolled": True,
    "steam_id": "..."
}
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å ‚úì
```bash
cd /workspaces/CursorAI/steam_auth
python -m py_compile app/steam_guard.py
# OK - –Ω–µ—Ç –æ—à–∏–±–æ–∫
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ ‚úì
```bash
grep -n "def " app/steam_guard.py
# –í—Å–µ –º–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úì
```bash
wc -l app/steam_guard.py
# 393 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- steam_guard.py: ~180 —Å—Ç—Ä–æ–∫ (–Ω–µ–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- –ê–ª–≥–æ—Ä–∏—Ç–º—ã: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è

### –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- steam_guard.py: **393 —Å—Ç—Ä–æ–∫** (–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- –ê–ª–≥–æ—Ä–∏—Ç–º—ã: **—Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º Steam API**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: **–ø–æ–¥—Ä–æ–±–Ω–∞—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏**
- –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã: **3 –¥–æ–±–∞–≤–ª–µ–Ω–æ** (get_confirmation_key, get_confirmation_operations, confirm_operation)

---

## üéì –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
1. **Steam Desktop Authenticator (SDA)** - https://github.com/Jessecar96/SteamGuard
   - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ C#
   - –ê–ª–≥–æ—Ä–∏—Ç–º base-23 –¥–ª—è –∫–æ–¥–æ–≤
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ mafile

2. **Steampy** - https://github.com/bukson/steampy
   - Python —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Steam API
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π HMAC-SHA1 –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
   - Binary —Ñ–æ—Ä–º–∞—Ç –¥–ª—è timestamps

3. **RFC 6238** - Time-based One-Time Password
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç TOTP –∞–ª–≥–æ—Ä–∏—Ç–º–∞
   - 30-—Å–µ–∫—É–Ω–¥–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
   - Dynamic Truncation (RFC 4226)

---

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### ‚úì –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 2FA –∫–æ–¥–æ–≤
```python
manager = SteamGuardManager()
code, remaining = manager.get_steam_guard_code(shared_secret)
# code = "2CVJD", remaining = 15
```

### ‚úì –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Mafiles
```python
mafile_path = manager.create_mafile_from_dict(account_data)
# –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ URI
```

### ‚úì –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
```python
key = manager.get_confirmation_key(identity_secret, timestamp, "allow")
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è Steam API
```

### ‚úì –ò–º–ø–æ—Ä—Ç –≤ –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```python
# URI –≤ mafile –ø–æ–∑–≤–æ–ª—è–µ—Ç:
# - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Google Authenticator
# - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Microsoft Authenticator
# - –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **–†–µ–∞–ª—å–Ω–∞—è Steam API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
   - –ó–∞–º–µ–Ω–∞ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã
   - –¢—Ä–µ–±—É–µ—Ç: access_token, session cookies

2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏**
   - NTP –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞–º–∏
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ time skew

3. **Device Management**
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Device ID —Ñ–æ—Ä–º–∞—Ç
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏

---

## üìù –§–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

- ‚úÖ **STEAM_GUARD_FIXES.md** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ **STEAM_AUTH_GUIDE.md** - –≥–∞–π–¥ –ø–æ steam_auth.py –º–æ–¥—É–ª—é
- ‚úÖ **DEVELOPER_GUIDE.md** - –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ steam_auth
- ‚úÖ **FILE_INDEX.md** - –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã

---

## üèÅ –ò—Ç–æ–≥

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª—å–Ω—ã–º Steam API —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ Steam –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ access tokens –∏ session cookies.

**–í–µ—Ä—Å–∏—è**: 1.1.0 ‚úÖ 
**–î–∞—Ç–∞**: 15 —è–Ω–≤–∞—Ä—è 2026
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: 100% —Å Steam Desktop Authenticator
