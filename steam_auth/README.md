# Steam Auth Manager

Приложение для управления Steam аккаунтами с поддержкой 2FA (Steam Guard).

## Возможности

- **Управление аккаунтами** - добавление, редактирование, удаление Steam аккаунтов
- **Steam Guard 2FA** - генерация кодов двухфакторной аутентификации
- **Mafile поддержка** - создание, импорт и экспорт mafiles (как в Steam Desktop Authenticator)
- **Подтверждения** - просмотр и подтверждение операций со своего аккаунта
- **Локальное хранилище** - все данные хранятся в локальной базе данных SQLite

## Требования

- Python 3.8+
- Kivy 2.2.1
- SQLite3
- Другие зависимости указаны в requirements.txt

## Установка

### На рабочем столе

```bash
# Установить зависимости
pip install -r requirements.txt

# Запустить приложение
python main.py
```

### На Android

Для сборки Android приложения используйте buildozer:

```bash
# Установить buildozer
pip install buildozer

# Собрать debug APK
buildozer android debug

# Собрать release APK (требует подписание)
buildozer android release
```

## Использование

### Главный экран

На главном экране вы видите:
- Кнопку "Accounts" с числом сохраненных аккаунтов
- Кнопки для переход в другие разделы

### Управление аккаунтами

1. **Просмотр списка** - нажмите "Accounts" чтобы увидеть все аккаунты
2. **Просмотр аккаунта** - нажмите на аккаунт из списка
3. **Редактирование** - нажмите кнопку "Edit" на странице аккаунта
4. **Удаление** - нажмите кнопку "Delete"
5. **Подтверждения** - нажмите "Confirmations" для просмотра операций

### Добавление аккаунта

1. На экране со списком аккаунтов нажмите "Add Account"
2. Выберите один из способов:
   - **Add Manually** - введите данные аккаунта вручную
   - **Create Mafile** - создайте mafile по данным аккаунта (как в SDA)
   - **Import Mafile** - импортируйте существующий mafile

### Способ добавления: Вручную

1. Введите имя Steam аккаунта
2. Введите пароль
3. Введите Shared Secret (base64 кодированный)
4. Нажмите "Save"

### Способ добавления: Создание Mafile

**НОВОЕ (v1.1)**: Теперь приложение использует многошаговый процесс создания mafile, аналогично Steam Desktop Authenticator (SDA):

**Шаг 1 - Ввод учетных данных:**
1. Введите имя Steam аккаунта
2. Введите пароль
3. Нажмите "Next"

**Шаг 2 - Подтверждение через Email/SMS:**
1. Выберите способ получения кода:
   - "Send Code to Email" - отправить на email
   - "Send Code via SMS" - отправить через SMS
2. Приложение отправит код подтверждения
3. Нажмите "Next" после получения кода

**Шаг 3 - Ввод кода подтверждения:**
1. Введите 5-значный код из email или SMS
2. Приложение проверит код
3. При успехе создастся mafile

**Шаг 4 - Завершение:**
1. Вы увидите сообщение об успехе
2. Аккаунт будет добавлен в БД
3. Mafile будет сохранен в папке `mafiles/`

**Важно**: Этот процесс имитирует реальный процесс Steam авторизации с двухфакторной аутентификацией.

### Способ добавления: Импорт Mafile

1. Укажите путь к существующему mafile
2. Введите пароль для этого аккаунта
3. Нажмите "Import"

## Структура проекта

```
steam_auth/
├── main.py                  # Главное приложение
├── requirements.txt         # Зависимости Python
├── buildozer.spec          # Конфиг для сборки Android
├── accounts.db             # База данных (создается автоматически)
├── mafiles/                # Папка с mafiles
└── app/
    ├── __init__.py
    ├── database.py         # Работа с SQLite
    ├── steam_guard.py      # Логика Steam Guard и mafiles
    └── screens.py          # Все экраны приложения
```

## Экраны приложения

1. **HomeScreen** - главный экран с кнопкой аккаунтов
2. **AccountsScreen** - список аккаунтов (по 4 на странице, можно прокручивать)
3. **AccountScreen** - информация об аккаунте с кнопками действия
4. **EditAccountScreen** - редактирование данных аккаунта
5. **ConfirmationsScreen** - список операций для подтверждения
6. **AddAccountScreen** - выбор способа добавления аккаунта
7. **ManualAddScreen** - ручное добавление
8. **CreateMafileScreen** - создание mafile
9. **ImportMafileScreen** - импорт mafile

## Функциональность базы данных

### Таблица accounts

- `id` - уникальный идентификатор
- `account_name` - имя Steam аккаунта (уникальное)
- `password` - пароль (в реальном приложении должен быть зашифрован)
- `shared_secret` - shared secret для 2FA
- `identity_secret` - identity secret (опционально)
- `revocation_code` - код восстановления (опционально)
- `created_at` - дата создания
- `updated_at` - дата последнего обновления

## Steam Guard

Приложение использует TOTP (Time-based One-Time Password) алгоритм для генерации 2FA кодов:

1. Декодирует shared_secret из base64
2. Вычисляет HMAC-SHA1 с текущим временем
3. Извлекает последние цифры для получения 5-значного кода
4. Код меняется каждые 30 секунд

## Маfiles

Mafile - это JSON файл, совместимый с Steam Desktop Authenticator:

```json
{
  "shared_secret": "...",
  "identity_secret": "...",
  "revocation_code": "...",
  "account_name": "...",
  "uri": "",
  "server_time": 1234567890,
  "account_name_hmac": "",
  "session_id": "",
  "fully_enrolled": true
}
```

## Безопасность

**ВАЖНО**: В текущей версии пароли хранятся в открытом виде. Для production версии необходимо:

1. Добавить шифрование пароля перед сохранением
2. Использовать безопасный алгоритм (например, bcrypt)
3. Добавить аутентификацию пользователя приложения
4. Использовать защищенное хранилище для ключей

## Лицензия

MIT

## Поддержка

Если у вас есть проблемы или вопросы, создайте issue в репозитории.
